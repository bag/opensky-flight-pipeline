bundle:
  name: flight-tracking-pipeline

workspace:
  host: https://adb-7405615726602978.18.azuredatabricks.net

variables:
  catalog:
    default: flight_tracking

resources:
  jobs:
    batch_etl:
      name: "OpenSky Batch ETL"
      schedule:
        quartz_cron_expression: "0 */10 * * * ?"
        timezone_id: "UTC"
      tasks:
        - task_key: bronze_ingestion
          notebook_task:
            notebook_path: ./notebooks/01_bronze_ingestion.py
            source: WORKSPACE

        - task_key: silver_transform
          depends_on:
            - task_key: bronze_ingestion
          notebook_task:
            notebook_path: ./notebooks/02_silver_transform.py
            source: WORKSPACE

        - task_key: gold_aggregates
          depends_on:
            - task_key: silver_transform
          notebook_task:
            notebook_path: ./notebooks/03_gold_aggregates.py
            source: WORKSPACE

    streaming_etl:
      name: "OpenSky Streaming ETL"
      schedule:
        quartz_cron_expression: "0 */10 * * * ?"
        timezone_id: "UTC"
      tasks:
        - task_key: landing_zone_poller
          notebook_task:
            notebook_path: ./notebooks/05_landing_zone_poller.py
            source: WORKSPACE

        - task_key: bronze_streaming
          depends_on:
            - task_key: landing_zone_poller
          notebook_task:
            notebook_path: ./notebooks/04_bronze_streaming.py
            source: WORKSPACE

        - task_key: silver_transform
          depends_on:
            - task_key: bronze_streaming
          notebook_task:
            notebook_path: ./notebooks/02_silver_transform.py
            source: WORKSPACE

        - task_key: gold_aggregates
          depends_on:
            - task_key: silver_transform
          notebook_task:
            notebook_path: ./notebooks/03_gold_aggregates.py
            source: WORKSPACE

targets:
  dev:
    mode: development
    default: true
    workspace:
      root_path: /Users/${workspace.current_user.userName}/.bundle/${bundle.name}/dev

  prod:
    mode: production
    workspace:
      root_path: /Shared/.bundle/${bundle.name}/prod
    run_as:
      user_name: ${workspace.current_user.userName}